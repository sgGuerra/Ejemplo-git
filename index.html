<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Buscador Reactivo ULTRA SIMPLE</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 600px; 
            margin: 50px auto; 
            padding: 20px; 
            background: #f0f8ff;
        }
        
        h1 { 
            text-align: center; 
            color: #2c3e50;
            margin-bottom: 30px;
        }
        
        input { 
            width: 100%; 
            padding: 15px; 
            font-size: 16px; 
            border: 2px solid #3498db; 
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .concept-section {
            background: white;
            border-left: 4px solid #e74c3c;
            padding: 15px;
            margin: 15px 0;
            border-radius: 5px;
        }
        
        .concept-title {
            font-weight: bold;
            color: #e74c3c;
            font-size: 14px;
            margin-bottom: 8px;
        }
        
        .code-highlight {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 5px 0;
            font-size: 12px;
        }
        
        .debug {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
            font-size: 13px;
        }
        
        .suggestion {
            background: white;
            padding: 10px;
            margin: 5px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .suggestion:hover {
            background: #e3f2fd;
        }
        
        .no-results {
            text-align: center;
            color: #666;
            padding: 20px;
            font-style: italic;
        }
    </style>
</head>
<body>
    <h1>üîç Buscador Reactivo ULTRA SIMPLE</h1>
    <p style="text-align: center; color: #666;">Versi√≥n m√≠nima para entender Observables, Observers y Pipes</p>
    
    <!-- INPUT DE B√öSQUEDA -->
    <input type="text" id="searchInput" placeholder="Escribe algo... (ej: java, python, react)">
    
    <!-- SECCI√ìN 1: OBSERVABLE -->
    <div class="concept-section">
        <div class="concept-title">üì° 1. OBSERVABLE (L√≠neas 80-95)</div>
        <p>Observa los cambios en el input y los convierte en un "stream" de datos</p>
        <div class="code-highlight">
            fromEvent(input, 'input') // ‚Üê Este es el OBSERVABLE
        </div>
        <div id="observable-debug" class="debug">Esperando eventos del input...</div>
    </div>
    
    <!-- SECCI√ìN 2: PIPES/OPERADORES -->
    <div class="concept-section">
        <div class="concept-title">üîß 2. PIPES/OPERADORES (L√≠neas 100-110)</div>
        <p>Transforman y filtran los datos que fluyen por el stream</p>
        <div class="code-highlight">
            .pipe(<br>
            &nbsp;&nbsp;debounceTime(300), // ‚Üê PIPE 1: Espera 300ms<br>
            &nbsp;&nbsp;filter(...),      // ‚Üê PIPE 2: Filtra texto corto<br>
            &nbsp;&nbsp;map(...)          // ‚Üê PIPE 3: Busca sugerencias<br>
            )
        </div>
        <div id="pipes-debug" class="debug">Pipes inactivos...</div>
    </div>
    
    <!-- SECCI√ìN 3: OBSERVER -->
    <div class="concept-section">
        <div class="concept-title">üëÅÔ∏è 3. OBSERVER (L√≠neas 115-125)</div>
        <p>Recibe los datos finales y actualiza la interfaz</p>
        <div class="code-highlight">
            .subscribe({ // ‚Üê Este es el OBSERVER<br>
            &nbsp;&nbsp;next: (data) => mostrarResultados(data)<br>
            })
        </div>
        <div id="observer-debug" class="debug">Observer esperando datos...</div>
    </div>
    
    <!-- RESULTADOS -->
    <div id="results">
        <div class="no-results">üí° Empieza a escribir para ver la magia reactiva</div>
    </div>

    <!-- RXJS desde CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/rxjs/7.8.1/rxjs.umd.min.js"></script>
    
    <script>
        // ============================================
        // üìä DATOS DE EJEMPLO (s√∫per simple)
        // ============================================
        const datos = [
            'JavaScript',
            'Java',
            'Python', 
            'React',
            'Vue.js',
            'Angular',
            'Node.js',
            'HTML',
            'CSS'
        ];
        
        // Referencias a elementos HTML
        const input = document.getElementById('searchInput');
        const observableDebug = document.getElementById('observable-debug');
        const pipesDebug = document.getElementById('pipes-debug');
        const observerDebug = document.getElementById('observer-debug');
        const results = document.getElementById('results');
        
        // ============================================
        // üì° PASO 1: CREAR OBSERVABLE
        // ============================================
        console.log('üöÄ PASO 1: Creando Observable...');
        
        // ‚≠ê AQU√ç EST√Å EL OBSERVABLE ‚≠ê
        const inputObservable = rxjs.fromEvent(input, 'input');
        
        // Debug: mostrar cuando el Observable emite
        inputObservable.subscribe(event => {
            const valor = event.target.value;
            observableDebug.innerHTML = `‚úÖ Observable emiti√≥: "<strong>${valor}</strong>"`;
            console.log('üì° Observable emiti√≥:', valor);
        });
        
        // ============================================
        // üîß PASO 2: AGREGAR PIPES/OPERADORES
        // ============================================
        console.log('üöÄ PASO 2: Agregando Pipes...');
        
        // ‚≠ê AQU√ç EST√ÅN LAS PIPES ‚≠ê
        const searchStream = inputObservable.pipe(
            // PIPE 1: Obtener solo el texto del input
            rxjs.operators.map(event => {
                const texto = event.target.value;
                pipesDebug.innerHTML = `üîß Pipe MAP: Extrajo texto "<strong>${texto}</strong>"`;
                return texto;
            }),
            
            // PIPE 2: Esperar 300ms despu√©s del √∫ltimo car√°cter
            rxjs.operators.debounceTime(300),
            rxjs.operators.tap(texto => {
                pipesDebug.innerHTML += `<br>‚è∞ Pipe DEBOUNCE: Esper√≥ 300ms, procesando "<strong>${texto}</strong>"`;
            }),
            
            // PIPE 3: Solo procesar si hay al menos 2 caracteres
            rxjs.operators.filter(texto => {
                const esValido = texto.length >= 2;
                if (esValido) {
                    pipesDebug.innerHTML += `<br>‚úÖ Pipe FILTER: Texto v√°lido (${texto.length} chars)`;
                } else {
                    pipesDebug.innerHTML += `<br>‚ùå Pipe FILTER: Texto muy corto (${texto.length} chars)`;
                    results.innerHTML = '<div class="no-results">üí° Escribe al menos 2 caracteres</div>';
                }
                return esValido;
            }),
            
            // PIPE 4: Buscar sugerencias
            rxjs.operators.map(texto => {
                const sugerencias = buscarSugerencias(texto);
                pipesDebug.innerHTML += `<br>üîç Pipe B√öSQUEDA: Encontr√≥ ${sugerencias.length} sugerencias`;
                return sugerencias;
            })
        );
        
        // ============================================
        // üëÅÔ∏è PASO 3: CREAR OBSERVER
        // ============================================
        console.log('üöÄ PASO 3: Creando Observer...');
        
        // ‚≠ê AQU√ç EST√Å EL OBSERVER ‚≠ê
        const observer = {
            next: (sugerencias) => {
                observerDebug.innerHTML = `üëÅÔ∏è Observer recibi√≥ ${sugerencias.length} sugerencias`;
                console.log('üëÅÔ∏è Observer recibi√≥:', sugerencias);
                mostrarSugerencias(sugerencias);
            },
            error: (error) => {
                observerDebug.innerHTML = `‚ùå Observer recibi√≥ error: ${error}`;
                console.error('üí• Error:', error);
            },
            complete: () => {
                observerDebug.innerHTML = `‚úÖ Observer completado`;
                console.log('üèÅ Stream completado');
            }
        };
        
        // ============================================
        // üîó PASO 4: CONECTAR TODO (SUSCRIPCI√ìN)
        // ============================================
        console.log('üöÄ PASO 4: Conectando Observable con Observer...');
        
        // ‚≠ê AQU√ç SE CONECTA TODO ‚≠ê
        const subscription = searchStream.subscribe(observer);
        
        console.log('‚úÖ ¬°Buscador reactivo listo!');
        console.log('üîÑ Flujo: Input ‚Üí Observable ‚Üí Pipes ‚Üí Observer ‚Üí UI');
        
        // ============================================
        // üîç FUNCIONES AUXILIARES
        // ============================================
        
        /**
         * Busca sugerencias en los datos
         */
        function buscarSugerencias(texto) {
            const textoMinuscula = texto.toLowerCase();
            return datos.filter(item => 
                item.toLowerCase().includes(textoMinuscula)
            );
        }
        
        /**
         * Muestra las sugerencias en la interfaz
         */
        function mostrarSugerencias(sugerencias) {
            if (sugerencias.length === 0) {
                results.innerHTML = '<div class="no-results">üîç No se encontraron resultados</div>';
                return;
            }
            
            const html = sugerencias
                .map(sugerencia => `
                    <div class="suggestion" onclick="seleccionar('${sugerencia}')">
                        ${sugerencia}
                    </div>
                `)
                .join('');
            
            results.innerHTML = html;
        }
        
        /**
         * Selecciona una sugerencia
         */
        function seleccionar(sugerencia) {
            input.value = sugerencia;
            alert(`‚úÖ Seleccionaste: ${sugerencia}`);
        }
        
        // ============================================
        // üìã RESUMEN FINAL
        // ============================================
        console.log('');
        console.log('üìö RESUMEN DE CONCEPTOS:');
        console.log('üì° Observable (l√≠nea 85): fromEvent(input, "input")');
        console.log('üîß Pipes (l√≠neas 95-115): map, debounceTime, filter, map');
        console.log('üëÅÔ∏è Observer (l√≠neas 120-130): objeto con next, error, complete');
        console.log('üîó Suscripci√≥n (l√≠nea 135): searchStream.subscribe(observer)');
        console.log('');
        console.log('üîÑ FLUJO DE DATOS:');
        console.log('1. Usuario escribe ‚Üí Observable emite evento');
        console.log('2. Pipes transforman: evento ‚Üí texto ‚Üí filtrado ‚Üí sugerencias');
        console.log('3. Observer recibe sugerencias ‚Üí actualiza interfaz');
        console.log('');
        console.log('¬°Empieza a escribir para verlo en acci√≥n! üöÄ');
    </script>
</body>
</html>